<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AutoU - Email Classifier (MVP)</title>
  <style>
    body{font-family:Inter,system-ui,Arial; max-width:900px;margin:32px auto;padding:0 16px;color:#111}
    header{display:flex;align-items:center;gap:12px}
    h1{margin:0}
    .card{border:1px solid #eee;padding:18px;border-radius:12px;margin-top:18px;box-shadow:0 6px 18px rgba(18,18,18,0.03)}
    textarea{width:100%;height:160px;padding:10px;border-radius:8px;border:1px solid #ddd;font-size:14px}
    input[type=file]{display:block;margin-top:8px}
    button{background:#0066FF;color:#fff;padding:10px 14px;border-radius:8px;border:0;font-weight:600;cursor:pointer}
    .result{margin-top:12px;padding:12px;border-radius:8px;background:#f9faff;border:1px solid #e6f0ff}
    .meta{font-size:13px;color:#666;margin-top:6px}
  </style>
</head>
<body>
<header>
  <h1>AutoU — Classificador de Emails (MVP)</h1>
</header>

<div class="card">
  <label><strong>Colar texto do email</strong></label>
  <textarea id="emailText" placeholder="Cole o conteúdo do email aqui..."></textarea>

  <div style="margin-top:8px">
    <label><strong>Ou enviar arquivo (.pdf / .txt)</strong></label>
    <input id="fileInput" type="file" accept=".pdf,.txt" />
  </div>

  <div style="margin-top:12px">
    <button id="submitBtn">Analisar email</button>
  </div>

  <div id="loading" class="meta" style="display:none">Processando…</div>

  <div id="output" style="display:none" class="result">
    <div><strong>Categoria:</strong> <span id="category"></span></div>
    <div class="meta"><strong>Confiança:</strong> <span id="confidence"></span></div>
    <hr />
    <div><strong>Resposta sugerida:</strong></div>
    <div style="margin-top:8px"><textarea id="reply" style="height:140px"></textarea></div>
    <div style="margin-top:8px">
      <button id="copyBtn">Copiar resposta</button>
    </div>
  </div>
</div>

<script>
const submitBtn = document.getElementById('submitBtn');
const fileInput = document.getElementById('fileInput');
const emailText = document.getElementById('emailText');
const loading = document.getElementById('loading');
const output = document.getElementById('output');
const categoryEl = document.getElementById('category');
const confidenceEl = document.getElementById('confidence');
const replyEl = document.getElementById('reply');
const copyBtn = document.getElementById('copyBtn');

submitBtn.addEventListener('click', async () => {
  loading.style.display = 'block';
  output.style.display = 'none';

  const form = new FormData();
  const text = emailText.value.trim();
  if (text) form.append('email_text', text);
  if (fileInput.files.length > 0) form.append('file', fileInput.files[0]);

  try {
    const res = await fetch('/analyze', { method: 'POST', body: form });
    if (!res.ok) throw new Error('Erro na requisição');
    const data = await res.json();
    categoryEl.innerText = data.category;
    confidenceEl.innerText = (data.confidence || 0).toFixed(2);
    replyEl.value = data.suggested_reply || '';
    output.style.display = 'block';
  } catch (err) {
    alert('Erro: ' + err.message);
  } finally {
    loading.style.display = 'none';
  }
});

copyBtn.addEventListener('click', () => {
  replyEl.select();
  document.execCommand('copy');
  copyBtn.innerText = 'Copiado!';
  setTimeout(()=> copyBtn.innerText='Copiar resposta', 1200);
});
</script>
</body>
</html>
